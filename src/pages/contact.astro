---
import MainLayout from '../layouts/MainLayout.astro';
import FormInput from '../components/atoms/FormInput.astro';
import FormTextarea from '../components/atoms/FormTextarea.astro';
import Button from '../components/atoms/Button.astro';
---

<MainLayout title="Contact" description="Contactez Aviaco pour toutes vos questions sur les pièces détachées d'hélicoptères et nos services de maintenance">
  <!-- Hero Section -->
  <section class="relative text-white py-20 md:py-28 lg:py-32 overflow-hidden">
    <!-- Background Image -->
    <div class="absolute inset-0 -z-10">
      <img 
        src="/copter/4.jpg" 
        alt="Helicopter" 
        class="w-full h-full object-cover"
        loading="eager"
      />
      <!-- Overlay -->
      <div class="absolute inset-0 bg-gradient-to-b from-black/70 via-black/50 to-black/60"></div>
    </div>
    
    <div class="container mx-auto px-4 relative z-10">
      <div class="max-w-3xl mx-auto text-center">
        <h1 class="font-outfit font-bold text-4xl md:text-5xl lg:text-6xl mb-4 hero-title">
          Contact us
        </h1>
        <p class="font-outfit text-xl md:text-2xl text-gray-100 hero-description">
          We're here to help you with all your helicopter spare parts needs
        </p>
      </div>
    </div>
  </section>

  <style>
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(40px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .hero-title {
      animation: fadeInUp 1s ease-out forwards;
      text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    }

    .hero-description {
      animation: fadeInUp 1s ease-out 0.3s forwards;
      opacity: 0;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.4);
    }
  </style>

  <!-- Contact Section -->
  <section class="py-16 md:py-24 bg-white dark:bg-gray-900">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-16">
        <!-- Contact Information -->
        <div class="space-y-8">
          <div>
            <h2 class="font-outfit font-bold text-3xl md:text-4xl mb-4 text-gray-900 dark:text-white">
              Get in touch
            </h2>
            <p class="font-outfit text-gray-600 dark:text-gray-400 text-lg leading-relaxed">
              Our team is ready to assist you with any questions about our helicopter spare parts, maintenance services, or technical support. Reach out to us using the information below or fill out the contact form.
            </p>
          </div>

          <!-- Contact Cards -->
          <div class="space-y-6">
            <!-- Phone -->
            <div class="flex items-start gap-4 p-6 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-shadow">
              <div class="flex-shrink-0 w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center">
                <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                </svg>
              </div>
              <div>
                <h3 class="font-outfit font-semibold text-lg mb-1 text-gray-900 dark:text-white">Phone</h3>
                <a href="tel:+33442141897" class="font-outfit text-gray-600 dark:text-gray-400 hover:text-primary transition-colors">
                  +33 4 42 14 18 97
                </a>
              </div>
            </div>

            <!-- Email -->
            <div class="flex items-start gap-4 p-6 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-shadow">
              <div class="flex-shrink-0 w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center">
                <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
              </div>
              <div>
                <h3 class="font-outfit font-semibold text-lg mb-1 text-gray-900 dark:text-white">Email</h3>
                <a href="mailto:rfq@aviaco.fr" class="font-outfit text-gray-600 dark:text-gray-400 hover:text-primary transition-colors break-all">
                  rfq@aviaco.fr
                </a>
              </div>
            </div>

            <!-- Address -->
            <div class="flex items-start gap-4 p-6 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-shadow">
              <div class="flex-shrink-0 w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center">
                <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
              </div>
              <div>
                <h3 class="font-outfit font-semibold text-lg mb-1 text-gray-900 dark:text-white">Address</h3>
                <p class="font-outfit text-gray-600 dark:text-gray-400">
                  Zac des Florides, Îlot Carmin, Bat 4<br />
                  Marignane, France
                </p>
              </div>
            </div>
          </div>

          <!-- Map -->
          <div class="mt-8">
            <h3 class="font-outfit font-semibold text-xl mb-4 text-gray-900 dark:text-white">Find us on the map</h3>
            <div class="w-full h-[300px] md:h-[400px] rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700 shadow-lg">
              <iframe
                src="https://www.google.com/maps?q=Zac+des+Florides,+Îlot+Carmin,+Bat+4,+Marignane,+France&output=embed&zoom=15"
                width="100%"
                height="100%"
                style="border:0;"
                allowfullscreen=""
                loading="lazy"
                referrerpolicy="no-referrer-when-downgrade"
                class="w-full h-full"
                title="Aviaco Location - Zac des Florides, Îlot Carmin, Bat 4, Marignane, France"
              ></iframe>
            </div>
            <p class="mt-3 text-sm text-gray-500 dark:text-gray-400 font-outfit">
              <a 
                href="https://www.google.com/maps/search/?api=1&query=Zac+des+Florides,+Îlot+Carmin,+Bat+4,+Marignane,+France" 
                target="_blank" 
                rel="noopener noreferrer"
                class="text-primary hover:underline"
              >
                View on Google Maps →
              </a>
            </p>
          </div>
        </div>

        <!-- Contact Form -->
        <div>
          <h2 class="font-outfit font-bold text-3xl md:text-4xl mb-8 text-gray-900 dark:text-white">
            Send us a message
          </h2>
          
          <form id="contact-form" class="space-y-6">
            <!-- Name -->
            <FormInput
              type="text"
              name="name"
              id="name"
              label="Full Name"
              placeholder="John Doe"
              required={true}
            />

            <!-- Email -->
            <FormInput
              type="email"
              name="email"
              id="email"
              label="Email Address"
              placeholder="john@example.com"
              required={true}
            />

            <!-- Phone -->
            <FormInput
              type="tel"
              name="phone"
              id="phone"
              label="Phone Number"
              placeholder="+33 6 12 34 56 78"
            />

            <!-- Subject -->
            <FormInput
              type="text"
              name="subject"
              id="subject"
              label="Subject"
              placeholder="How can we help you?"
              required={true}
            />

            <!-- Message -->
            <FormTextarea
              name="message"
              id="message"
              label="Message"
              placeholder="Tell us more about your inquiry..."
              rows={6}
              required={true}
            />

            <!-- Submit Button -->
            <div>
              <Button
                type="submit"
                variant="primary"
                size="lg"
                class="w-full md:w-auto"
                id="submit-btn"
              >
                <span id="submit-text">Send Message</span>
                <span id="submit-loading" class="hidden">
                  <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  Sending...
                </span>
              </Button>
            </div>

            <!-- Success Message -->
            <div id="success-message" class="hidden p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg">
              <div class="flex items-center gap-3">
                <svg class="w-5 h-5 text-green-600 dark:text-green-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <p class="font-outfit text-green-800 dark:text-green-200">
                  Thank you! Your message has been sent successfully. We'll get back to you as soon as possible.
                </p>
              </div>
            </div>

            <!-- Error Message -->
            <div id="error-message" class="hidden p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg">
              <div class="flex items-center gap-3">
                <svg class="w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
                <p class="font-outfit text-red-800 dark:text-red-200" id="error-text">
                  An error occurred. Please try again later.
                </p>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>

  <script>
    const form = document.getElementById('contact-form') as HTMLFormElement;
    const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
    const submitText = document.getElementById('submit-text') as HTMLSpanElement;
    const submitLoading = document.getElementById('submit-loading') as HTMLSpanElement;
    const successMessage = document.getElementById('success-message') as HTMLDivElement;
    const errorMessage = document.getElementById('error-message') as HTMLDivElement;
    const errorText = document.getElementById('error-text') as HTMLParagraphElement;

    if (form) {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        // Reset messages
        successMessage.classList.add('hidden');
        errorMessage.classList.add('hidden');
        
        // Disable submit button
        submitBtn.disabled = true;
        submitText.classList.add('hidden');
        submitLoading.classList.remove('hidden');
        
        // Get form data
        const formData = new FormData(form);
        const data = {
          name: formData.get('name'),
          email: formData.get('email'),
          phone: formData.get('phone') || '',
          subject: formData.get('subject'),
          message: formData.get('message'),
        };
        
        try {
          const response = await fetch('/api/contact', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
          });
          
          const result = await response.json();
          
          if (response.ok) {
            // Show success toast
            if (window.showToast) {
              window.showToast('Thank you! Your message has been sent successfully. We will respond as soon as possible.', 'success', 6000);
            } else {
              successMessage.classList.remove('hidden');
              successMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            form.reset();
          } else {
            // Show error toast
            const errorMsg = result.error || 'An error occurred. Please try again later.';
            if (window.showToast) {
              window.showToast(errorMsg, 'error', 6000);
            } else {
              errorText.textContent = errorMsg;
              errorMessage.classList.remove('hidden');
              errorMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
          }
        } catch (error) {
          // Show error toast
          if (window.showToast) {
            window.showToast('Network error. Please check your connection and try again.', 'error', 6000);
          } else {
            errorText.textContent = 'Network error. Please check your connection and try again.';
            errorMessage.classList.remove('hidden');
            errorMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          }
        } finally {
          // Re-enable submit button
          submitBtn.disabled = false;
          submitText.classList.remove('hidden');
          submitLoading.classList.add('hidden');
        }
      });
    }
  </script>
</MainLayout>

