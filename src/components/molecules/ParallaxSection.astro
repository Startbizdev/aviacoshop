---
interface Props {
  title: string;
  content: string;
  image: string;
  imageAlt?: string;
}

const { title, content, image, imageAlt = "Background" } = Astro.props;
---

<section class="parallax-section relative min-h-[400px] md:min-h-[500px] lg:min-h-[600px] overflow-hidden flex items-center">
  <!-- Parallax Background -->
  <div class="parallax-bg absolute inset-0 w-full h-[120%] -z-10">
    <img 
      src={image} 
      alt={imageAlt} 
      class="w-full h-full object-cover"
      loading="lazy"
      decoding="async"
    />
    <!-- Overlay gradient -->
    <div class="absolute inset-0 bg-gradient-to-b from-black/70 via-black/60 to-black/70"></div>
  </div>
  
  <!-- Content -->
  <div class="relative z-10 container mx-auto px-4 py-12 md:py-16">
    <div class="max-w-4xl mx-auto text-center text-white">
      <h2 class="font-outfit font-bold text-3xl md:text-4xl lg:text-5xl mb-4 md:mb-6">
        {title}
      </h2>
      <p class="font-outfit text-base md:text-lg lg:text-xl leading-relaxed">
        {content}
      </p>
    </div>
  </div>
</section>

<style>
  .parallax-section {
    isolation: isolate;
  }
  
  .parallax-bg {
    will-change: transform;
    backface-visibility: hidden;
    transform: translateZ(0);
  }
  
  @media (prefers-reduced-motion: reduce) {
    .parallax-bg {
      transform: none !important;
    }
  }
</style>

<script>
  (function() {
    'use strict';
    
    const initParallax = () => {
      const parallaxBg = document.querySelector('.parallax-bg');
      const section = document.querySelector('.parallax-section');
      
      if (!parallaxBg || !section) return;
      
      let ticking = false;
      
      const updateParallax = () => {
        if (ticking) return;
        
        ticking = true;
        requestAnimationFrame(() => {
          const scrollY = window.scrollY || window.pageYOffset;
          const sectionRect = section.getBoundingClientRect();
          const windowHeight = window.innerHeight;
          
          // Vérifier si la section est visible
          const isVisible = sectionRect.bottom >= 0 && sectionRect.top <= windowHeight;
          
          if (isVisible) {
            // Calculer la position de la section par rapport au viewport
            // Quand on scroll vers le bas, l'image doit bouger vers le haut (négatif)
            const sectionTop = sectionRect.top;
            const sectionHeight = sectionRect.height;
            
            // Calculer le pourcentage de scroll dans la section
            // 0 = section en haut du viewport, 1 = section en bas
            const scrollProgress = Math.max(0, Math.min(1, (windowHeight - sectionTop) / (windowHeight + sectionHeight)));
            
            // L'image bouge dans la direction opposée au scroll
            // Vitesse du parallaxe (ajustable)
            const parallaxSpeed = 0.5;
            const maxOffset = sectionHeight * parallaxSpeed;
            const yOffset = scrollProgress * maxOffset;
            
            // Appliquer la transformation uniquement à l'image de fond
            parallaxBg.style.transform = `translate3d(0, ${-yOffset}px, 0)`;
          } else {
            // Réinitialiser quand la section n'est pas visible
            parallaxBg.style.transform = 'translate3d(0, 0, 0)';
          }
          
          ticking = false;
        });
      };
      
      // Écouter le scroll avec passive pour de meilleures performances
      window.addEventListener('scroll', updateParallax, { passive: true });
      
      // Initialiser au chargement
      updateParallax();
      
      // Réinitialiser au resize
      let resizeTimeout;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(updateParallax, 100);
      }, { passive: true });
    };
    
    // Attendre que le DOM soit prêt
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initParallax);
    } else {
      initParallax();
    }
  })();
</script>

